## 22.03.15_일기같은그라파나테이블구성

## 01.운동테이블

```sql
CREATE TABLE exercise(
  year date,
  name varchar,
  minute numeric,
  distance numeric,
  calories numeric,
  count_m numeric,
  primary key(year,name)
);
```

- date
  - 운동한날짜
- name 
  - 운동이름
- minute
  - 운동한 시간 분단위
- distance
  - 런닝또는 걷는것 거리
- calories
  - 칼로리 나오는 운동에 대해서 칼로리
- count_m
  - 근력운동에 대한 카운트
  

```sql
      insert into exercise (year, name, minute, distance, calories, count_m)values
      ('2022-03-15','기울기 런닝머신', 30.27, 2.560, 507,0),
      ('2022-03-15','런닝머신',20.11,2.610,111.60,0),
      ('2022-03-16','기울기 런닝머신', 35.06, 3.029, 602,0),
      ('2022-03-16','런닝머신',21.27,2.480,108.0,0),
      ('2022-03-17','기울기 런닝머신', 35.10, 3.143, 624,0),
      ('2022-03-17','런닝머신',25.17,3.000,130.00,0),
      ('2022-03-18','기울기 런닝머신', 34.01, 3.005, 596,0),
      ('2022-03-18','런닝머신',26.42,3.000,132.10,0),
      ('2022-03-20','기울기 런닝머신', 34.49,2.971,591,0),
      ('2022-03-20','런닝머신',25.21,3.000,130.04,0),
      ('2022-03-21','기울기 런닝머신', 33.23,3.004,607,0),
      ('2022-03-21','런닝머신',25.17,3.000,130.04,0),
      ('2022-03-23','기울기 런닝머신', 34.36,3.004,568,0),
      ('2022-03-23','런닝머신',24.90,3.001,130.07,0),
      ('2022-03-24','기울기 런닝머신', 36.32,3.014,692,0),
      ('2022-03-24','런닝머신',23.90,3.000,125.00,0),
      ('2022-03-25','기울기 런닝머신', 36.24,3.006,599,0),
      ('2022-03-25','런닝머신',24.11,3.000,129.00,0),
      ('2022-03-28','기울기 런닝머신',30.41,3.013,592,0),
      ('2022-03-28','런닝머신',31.46,4.010,171.00,0),
      ('2022-03-29','기울기 런닝머신',41.23,4.073,780,0),
      ('2022-03-29','런닝머신',26.17,3.000,131.50,0),
      ('2022-03-30','기울기 런닝머신',37.09,3.569,651,0),
      ('2022-03-30','런닝머신',25.05,3.120,133.00,0),
      ('2022-03-31','기울기 런닝머신',33.34,3.113,592,0),
      ('2022-03-31','런닝머신',25.28,2.96,129.00,0),
      ('2022-04-04','기울기 런닝머신',36.11,3.211,598,0),
      ('2022-04-04','런닝머신',26.44,3.00,131.00,0),
      ('2022-04-15','기울기 런닝머신',42.51,3.475,681,0),
      ('2022-04-15','런닝머신',27.29,3.00,132.00,0),
      ('2022-04-17','기울기 런닝머신',38.48,3.131,685,0),
      ('2022-04-17','런닝머신',30.56,3.31,147.00,0), 
      ('2022-04-18','기울기 런닝머신',60.00,4.986,1094,0),
      ('2022-04-20','기울기 런닝머신',41.58,3.466,668,0),
      ('2022-04-20','런닝머신',29.17,3.00,134.80,0), 
      ('2022-04-21','서핑',55,0,0,0);

```

## 02.홈운동테이블

```sql
CREATE TABLE home_exercise(
 year date,
 name text,
 minute numeric,
 count_m numeric,
 primary key(year,name)
);
```

- date
  - 운동한날짜
- name 
  - 운동이름
- minute
  - 근력운동 외 시간이있는 운동
- count_m
  - 근력 운동한 카운트

```sql
INSERT INTO home_exercise (year,name,minute,count_m)values
('2022-04-03','요가',38.52,0),
('2022-04-03','크런치',0,100),
('2022-04-03','브릿지',0,50),
('2022-04-03','팔굽혀펴기',0,50),
('2022-04-03','스쿼트',0,50),
('2022-04-05','요가',20.00,0),
('2022-04-05','크런치',0,100),
('2022-04-05','브릿지',0,100),
('2022-04-05','팔굽혀펴기',0,50),
('2022-04-05','스쿼트',0,100),
('2022-04-11','요가',31.46,0),
('2022-04-11','크런치',0,100),
('2022-04-11','브릿지',0,100),
('2022-04-11','팔굽혀펴기',0,50),
('2022-04-11','스쿼트',0,100),
('2022-04-17','브릿지',0,50),
('2022-04-17','팔굽혀펴기',0,50),
('2022-04-17','스쿼트',0,50),
('2022-04-17','바이시클_크런치',0,50),
('2022-04-21','크런치',0,100),
('2022-04-21','브릿지',0,50),
('2022-04-21','레그레이즈',0,50),
('2022-04-21','바이시클_크런치',0,50),
('2022-04-25','요가',25.00,0),
('2022-04-25','크런치',0,100),
('2022-04-25','브릿지',0,50),
('2022-04-25','레그레이즈',0,50),
('2022-04-25','바이시클_크런치',0,50),
('2022-04-28','요가',25.00,0),
('2022-04-28','크런치',0,100),
('2022-04-28','브릿지',0,100),
('2022-04-28','바이시클_크런치',0,50),
('2022-05-09','요가',25.00,0),
('2022-05-09','크런치',0,100),
('2022-05-10','요가',29.00,0),
('2022-05-11','요가',35.00,0),
('2022-05-11','크런치',0,100),
('2022-05-21','크런치',0,100),
('2022-05-21','레그레이즈',0,100),
('2022-05-21','팔굽혀펴기',0,50),
('2022-05-21','윗몸일으키시',0,100),
('2022-05-21','스쿼트',0,100),
('2022-06-10','요가',25.00,0),
('2022-06-13','요가',25.00,0),
('2022-06-14','요가',40.00,0),
('2022-06-16','요가',20.00,0),
('2022-06-22','요가',20.00,0),
('2022-06-22','홈트레이닝',15.00,0),
('2022-06-23','요가',20.00,0),
('2022-06-24','요가',20.00,0),
('2022-06-26','레그레이즈',0,100),
('2022-06-26','크런치',0,100),
('2022-06-26','브릿지업다운',0,100),
('2022-06-26','바이시클_크런치',0,100),
('2022-06-27','레그레이즈',0,100),
('2022-06-27','크런치',0,120),
('2022-06-27','브릿지업다운',0,100),
('2022-06-27','바이시클_크런치',0,100),
('2022-06-27','스쿼트',0,100)
('2022-07-04','바이시클_크런치',0,100),
('2022-07-04','크런치',0,100),
('2022-07-04','사이드_레그레이즈(오)',0,30),
('2022-07-04','사이드_레그레이즈(왼)',0,30),
('2022-07-04','레그레이즈',0,30),
('2022-07-05','레그레이즈',0,150),
('2022-07-05','브릿지업다운',0,150),
('2022-07-05','브릿지유지',150,0),
('2022-07-06','레그레이즈',0,300),
('2022-07-06','브릿지유지',300,0),
('2022-07-07','레그레이즈',0,300),
('2022-07-07','브릿지유지',300,0),
('2022-07-07','브릿지업다운',300,0);

```









## 그래프 배포를 위한 준비

- 그래프를 그냥 그리려고 하면 그려지지 않음 

- embed 문제

  ![image-20220328084939304](assets/img/22.03.15_일기같은그라파나테이블구성/image-20220328084939304.png)

```sh
docker exec -it -u 0 grafana sh
```

- bin/bash로 해야하는데 안되서 sh로 함
  - 아마 우분투로 설치해서 그럴수도 있을듯
- vim,이나 vi, nano가 없음
  - apt-get update
  - apt-get install vim
    - 위와 같이 해야 설치가 됨
- vim /etc/grafana/grafana.ini
  - 위의 경로에서 수정해야함

![image-20220328090419651](assets/img/22.03.15_일기같은그라파나테이블구성/image-20220328090419651.png)

- ;allow_embedding = true로 변경

## 우회 방법

- 누구든지 Grafana 화면을 볼 수 있도록 설정하여 로그인 없이 바로 대시보드 화면 표시

  ```
  [auth.anonymous]
  # enable anonymous access
  ;enabled = false
  ```

- `;enabled = false` 를 `enabled = true`로 변경

![image-20220328090525131](assets/img/22.03.15_일기같은그라파나테이블구성/image-20220328090525131.png)



```
version: '3.1'

services:
  grafana1:
    image: grafana/grafana:main-ubuntu
    container_name: grafana
    restart: always
    ports:
      - 3000:3000
  grafana_lotto:
    image: grafana/grafana:main-ubuntu
    container_name: grafana_lotto
    restart: always
    ports:
      - 3001:3001
  postgres:
    image: postgres:alpine3.15
    container_name: postgres
    restart: always
    environment:
      POSTGRES_USER: postgres     # define credentials
      POSTGRES_PASSWORD: rud123 # define credentials
      POSTGRES_DB: postgres       # define database
    ports:
      - 5432:5432                 # Postgres port
    volumes:
      - /srv/dev-disk-by-uuid-7e3b293b-4892-4fe1-acaa-48266784dda8/docker/postgres/sql:/docker-entrypoint-initdb.d

```

 ##  Crontab 부분
 ```sh
 

30 22 * * 6 date >> /srv/dev-disk-by-uuid-7e3b293b-4892-4fe1-acaa-48266784dda8/Nas1/goWeb/lotto.log 2>&1
30 22 * * 6 /srv/dev-disk-by-uuid-7e3b293b-4892-4fe1-acaa-48266784dda8/Nas1/goWeb/goLottoCollect/web >> /srv/dev-disk-by-uuid-7e3b293b-489>
00 13 * * * date >> /srv/dev-disk-by-uuid-7e3b293b-4892-4fe1-acaa-48266784dda8/Nas1/goWeb/temp/temp.log 2>&1
01 13 * * * vcgencmd measure_temp  >> /srv/dev-disk-by-uuid-7e3b293b-4892-4fe1-acaa-48266784dda8/Nas1/goWeb/temp/temp.log 2>&1


```
